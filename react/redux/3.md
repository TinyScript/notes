# ä¸€ç¯ï¼šæ‰‹æ‘¸æ‰‹æ•™å­¦å®ç°ä¸€ä¸ªreduxï¼ˆä¸‰ï¼‰
ä¹‹å‰è®²å®Œ`changeState`åˆ°`å®šä¹‰reducer`å’Œ`dispatch + action`çš„è½¬å˜ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€äº›å°é—®é¢˜ï¼Œæ¯”å¦‚reducerå®šä¹‰å¯èƒ½ä¼šæœ‰å¾ˆå¤šä¸ªï¼Œæ‰€ä»¥è¦ä¼˜åŒ–ä¸€ä¸‹createStoreçš„reducerå…¥å£ã€‚

```javascript
import { createStore, combineReducers } from "./redux/index.js";
import counterReduer from "./reducers/counter.js";
import infoReduer from "./reducers/info.js";
let initState = {
  counter: {
    count: 0
  },
  info: {
    name: "",
    description: "é»˜è®¤çš„æè¿°"
  }
};
const reducer = combineReducers({
  counter: counterReduer,
  info: infoReduer
});
let store = createStore(reducer, initState);
console.log("å–å½“å‰çš„é»˜è®¤çŠ¶æ€",store.getState());
store.subscribe(() => {
  let state = store.getState();
  console.log("è·å–å½“å‰çš„çŠ¶æ€", state);
});

setTimeout(function(){
  store.dispatch({
    type: "INCERMENT"
  });
},1000)


setTimeout(function(){
  store.dispatch({
    type: "SET_NAME",
    name:"äº¬ç¨‹ä¸€ç¯ğŸ®"
  });
},2000)
```

- è§£å†³å¤šä¸ªreducerçš„é—®é¢˜ï¼Œæ‰€ä»¥åŠ å…¥äº†combineReducersã€‚
- æ­¤æ—¶çš„reduceræ— è®ºæœ‰å¤šå°‘ä¸ªï¼Œéƒ½ä¼šå…ˆæ‰”è¿›combineReducersä¸­è¿›è¡Œåˆå¹¶ï¼Œç„¶åæ‰åˆ°createStoreä¸­ã€‚

æ‰€ä»¥è¿™ä¸€æ¬¡çš„æ ¸å¿ƒå°±æ˜¯combineReducersã€‚
```javascript
export default function combineReducers(reducers) {
  const reducerKeys = Object.keys(reducers);
  //reducerå¿…ç„¶çš„ state action
  return function combination(state = {}, action) {
    /**ç”Ÿæˆä¸€ä¸ªæ–°çš„state */
    const nextState = {};
    for (let item of reducerKeys) {
      const reducer = reducers[item];
      //ä¸Šä¸€æ­¥çš„state
      const previousStateForKey = state[item];
      const nextStateForKey = reducer(previousStateForKey, action);
      nextState[item] = nextStateForKey;
    }
    return nextState;
  };
}
```
- combineReducersé¡¾åæ€ä¹‰å°±æ˜¯è¦æ¥æ”¶reducersé›†åˆäº†ï¼Œå¹¶ä¸”æ¥æ”¶äº†ä»¥åè¿˜ä¼šå¯¹å®ƒè¿›è¡Œå¤„ç†ï¼Œå½“ç„¶é¦–æ¬¡æ‰§è¡Œæ—¶æ˜¯ä¸ä¼šå¤„ç†çš„ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ã€‚
- ä¹Ÿå°±æ˜¯è¯´é¦–æ¬¡æ‰§è¡Œå®Œä¼šè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå·§å¦™çš„å¤„ç†æ‰€æœ‰åˆå¹¶è¿›æ¥çš„ reducerã€‚
- é¦–å…ˆä»£ç ä¼šå–ä¼ è¿›æ¥è¿™å†™reducerçš„keyã€‚
- ç„¶åå¤–éƒ¨è°ƒç”¨combinationæ—¶ï¼Œä¼šä¼ ä¸€ä¸ªstateä¸actionï¼Œçœ‹ç€å¾ˆçœ¼ç†Ÿï¼Œæ²¡é”™ï¼Œå°±æ˜¯ä¸ºäº†å–ä»£åŸæ¥çš„reducerç”¨çš„ã€‚
- ä¸å…¶è¯´å–ä»£ï¼Œä¸å¦‚è¯´æ˜¯åœ¨å•ä¸€çš„reduceråŸºç¡€ä¸Šè¿›è¡Œäº†å°è£…ï¼Œè®©dispatchå¸¦ä¸Šaction.typeè°ƒç”¨ä¸€ä¸ªreducerï¼Œå°±ä¼šå¾€æ‰€æœ‰çš„reduceræ‰¾ï¼Œç›¸å½“äºnginxåå‘ä»£ç†çš„åŸç†ã€‚
- æ–°è¿”å›çš„å‡½æ•°ä¸­ï¼Œä¼šå…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„stateå¯¹è±¡ã€‚
- ç„¶åéå†åˆšåˆšçš„reducersKeyï¼Œæ ¹æ®keyå’Œä¼ è¿›æ¥çš„reducersï¼Œæ‹¿åˆ°æ¯ä¸€ä¸ª`keyå¯¹åº”çš„reducer`å’Œ`keyå¯¹åº”çš„state`ã€‚
- ç„¶åå†é€šè¿‡keyæ‰¾åˆ°çš„reducerï¼Œå¯¹keyæ‰¾åˆ°stateï¼Œè¿›è¡Œaction.typeçš„å˜æ›´ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„stateï¼Œç»™åˆ°ä¹‹å‰åˆ›å»ºçš„stateå¯¹è±¡ï¼ˆnextStateï¼‰ã€‚
- è¦æ³¨æ„ï¼Œè¿™é‡Œæ¯ä¸ªreduceréƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæ— è®ºåœ¨reduceræœ‰æ²¡æ‰¾åˆ°actionï¼Œéƒ½ä¼šè¿”å›keyå¯¹åº”çš„stateï¼Œå¹¶ä¸”ç»™åˆ°nextStateã€‚
- æœ€åè¿”å›ä¸€æ•´ä¸ªnextStateæ ‘ã€‚

> PS:é’ˆå¯¹æ¯ä¸€æ¬¡reduceræ›´æ–°çš„stateï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªhasChangedçš„å“¨å…µå˜é‡ï¼Œåˆ¤æ–­reduceræ‰§è¡Œåå¾—åˆ°çš„stateä¸ä¼ å…¥æ—¶çš„stateæ˜¯å¦ç›¸åŒ<br/>
> æœ‰ä¸€ä¸ªä¸ºtrueéƒ½å¯ä»¥è¿”å›nextStateäº†ï¼Œå¦åˆ™å°±è¿”å›combinationçš„stateã€‚

#### æ€»ç»“
- ä¸ºäº†è§£å†³å¤šä¸ªreducerçš„é—®é¢˜ï¼Œåšå‡ºäº†combineReducerçš„æ–¹æ³•ã€‚
- combineReduceræ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œä¼šæ¥å—æ‰€æœ‰çš„reducerï¼Œç„¶åè¿”å›ä¸€ä¸ªå¾…æ‰§è¡Œçš„reducerï¼Œå¹¶ä¼ å…¥createStoreå‡½æ•°ä¸­ä¾›dispatchä½¿ç”¨ã€‚
- store.dispatchè°ƒç”¨æ—¶ï¼Œå°†ä¼šæ‰§è¡Œreducerè¿”å›stateï¼Œè¿™å’Œä»¥å‰æ²¡ä»€ä¹ˆä¸¤æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯è¿™ä¸ªreducerå‡½æ•°ä¼šè§¦å‘æ‰€æœ‰çš„reducerã€‚
- æœ€åæ€»reducerså†…éƒ¨ä¼šæ„æˆæ–°çš„stateæ ¹ï¼Œç„¶åå°†æ‰€æœ‰å­reducerå‡½æ•°æ‰§è¡Œåè¿”å›çš„stateå¡åˆ°æ–°çš„stateæ ¹ä¸­è¿”å›åˆ°createStoreã€‚

ä»£ç å¤§è‡´å¦‚ä¸‹ï¼ŒcombineReducerä¸Šè¾¹æœ‰ï¼Œå¹¶ä¸”å¸¦äº†æ–‡å­—è§£é‡Šå°±ä¸å†™å‡ºæ¥äº†ã€‚
```javascript
function createStore(reducers, init_state) {
  let state = init_state;

  function dispatch(actions) {
    const state = reducers(actions);
  }
}

const reducers = combineReducer({
  todo1: { a: 1 },
  todo2: { b: 2 }
})

const store = createStore(reducers);

store.dispatch({ type: 'ADD_TODO' });
```